{% extends "home/base.html" %}
{% load static%}
{% load crispy_forms_tags %}

{% block content %}
<style>

.up{
   position: absolute;
   top: 50%;
   left: 50%;
}

.not-visible{
   display: none;
}

.containment{
   position: relative;
   width: 100%;
}

.containment .section{
   position: sticky;
   top: 0;
   width: 100%;
   height: 100vh;
   background-color: black;
}

.containment .section:nth-child(1){
   background-image: url("{% static 'images/un.png'%}");
   background-position:top;
   background-size: cover;
}

.containment .section:nth-child(2){
   background-image: url("{% static 'images/page3.jpg'%}");
   background-size: cover;
}
.containment .section:nth-child(3){
   background-image: url("{%static 'images/mountain.png'%}");
}


.reg{
   position: absolute;
   top: 50%;
   left:50%
}

div#img-box,div#alert-box{
   width: 100%;
   height: 30vh;
}


</style>


<div class="containment">
   <div class="section">
      <div class="upload-csv">
         <div class="inner-container">
             <div class="upload-form">

      <form action="{%url 'uploading'%}" id="upload-form" method="POST" enctype="multipart/form-data" class="up">
         {%csrf_token%}
          <select name="events" id="">
            {% for events in events%}
               <option value="{{events.id}}">{{events.event_name}}</option>

            {% endfor%}
         </select>
         <br>
         <select name="year" id="">
            {%for year in year%}
            <option value="{{year}}">{{year}}</option>
            {%endfor%}
         </select>
         <br>
         <input type="file" name="file" id="file">

         <br>
         <div id="progress-box" class="not-visible">
            <div class="progress">
               <div class="progress-bar progress-bar-striped bg-danger progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
             </div>
         </div>
         <div id="cancel-box" class="not-visible mt-5 mb-3">
            <button id="cancel-btn"class="btn btn-danger">cancel</button>
         </div>
         <input type="submit" value="submit" name="fi">
      </form>
      </div>
      </div>
      </div>
   </div>
   <div class="section">

      <form action="{%url 'uploading'%}" method="POST" class="reg">
         {%csrf_token%}
         {{register.as_p|safe}}
         <input type="submit" value="submit" name="su">
      </form>

   </div>
   <div class="section">
         <div class="mt-3">
            <div id="img-box"></div>
            <div id="alert-box"></div>
            <form action="{% url 'uploading'%}" id="p-form">
               {%csrf_token%}
               {{photos|crispy}}
               <input type="submit" class="btn btn-danger iubutton" name="photos" value="submit" >
            </form>

         </div>
   </div>

   <script>
       const alertbox = document.getElementById('alert-box')
        const imgBox = document.getElementById('img-box')
        const form = document.getElementById('p-form')
        const names = document.getElementById('id_name')
        const description = document.getElementById('id_description')
        var contri = document.getElementById('id_types')
        const image = document.getElementById('id_image')
        console.log(image)
        console.log(contri)
        const url = ""
        const csrf = document.getElementsByName('csrfmiddlewaretoken')
        const handleAlerts = (type,text) =>{
            alertbox.innerHTML = `<div class="alert alert-${type}" role="alert">
                                        ${text}
                                 </div>`
        }

        image.addEventListener('change',()=>{
            const img_data = image.files[0]
            console.log(img_data)
            console.log(contri)
            const url = URL.createObjectURL(img_data)

            imgBox.innerHTML = `<img src="${url}" width="100%" height="100%">`

        })

        form.addEventListener('submit',e=>{
            e.preventDefault()
            spp = contri.value
            console.log(spp)
            const fd = new FormData()
            fd.append('csrfmiddlewaretoken',csrf[0].value)
            fd.append('name',names.value)
            fd.append('description',description.value)
            fd.append('image',image.files[0])
            fd.append('types',spp)

            $.ajax({
                type:'POST',
                url:url,
                enctype:'multipart/form-data',
                data:fd,
                success:function(response){
                    const sText = `successfully saved ${response.names}`
                    console.log(response)
                    handleAlerts('success',sText)
                    setTimeout(()=>{
                        alertbox.innerHTML=""
                        imgBox.innerHTML=""
                        names.value=""
                        description.value=""
                        image.value=""
                        types.value=""

                    },2000)
                },
                error:function(error){
                    handleAlerts('danger','something went wrong')
                },
                cache:false,
                contentType:false,
                processData:false,

            })

    })
   </script>

{% endblock content%}